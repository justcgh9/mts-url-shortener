# URL Shortener

Этот проект представляет собой предельно простой сервис для сокращения длинных урлов.

## Информация о хостинге

В качестве платформы для деплоя будет использовано Яндекс Облако, так же я буду использовать своё доменное имя, но рег.ру указывает, что на смену DNS серверов с их на облачные может уйти определенное время (записи я создал, просто только перешел на Cloud dns). В целом сайт API должен появиться [здесь](http://mts.justcoolestgiraffe9.ru/), на текущий момент ip балансера вот такой: 158.160.138.45

Так как одним из требований был скейлинг самого сервиса, я оставил БД (Postgres) на виртуалке, а само приложение положил в кластер k8s. Все манифесты можно найти [тут](/k8s), я указал три реплики приложения и один балансер, который будет слушать на дефолтном http порту и проксировать трафик подам.

## Эндпоинты приложения

У сервера, как и требовалось, два эндпоинта:

- `POST /` , принимает json-body, в котором должен быть указан url, а также имеется опциональный alias_length, возвращает alias
- `GET /{alias}`, через параметр урла достает нужный урл и редиректит пользователя 

## Сборка и развертывание 

Здесь Вы можете найти инструкцию по развертыванию, на данный момент все команды придется писать целиком, если появится время, добавлю `Makefile`

Собрать и развернуть приложение можно пользуясь `docker`. Для этого в репозитории написаны `Dockerfile` и `docker-compose.yml`, а так же я специально запушил примеры конфигов и `.env` файл, чтобы можно было понять, каких переменные окружения необходимы.
Для того, чтобы все запустить можно воспользоваться командой:

```sh
docker-compose up -d
```

У меня база данных описана в том же docker-compose файлике, поэтому *ВАЖНО* произвести миграции до того, как обращатсья к приложению (подставьте свой URL для подключения к базе, если он отличается):

```sh
go run cmd/migrator/main.go -db "postgres://user:StrongRandomPassword123@localhost:5433/db?sslmode=disable" -path "./migrations" -action up 
```
